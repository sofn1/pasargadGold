{% extends "_base.html" %}
{% block title %}لیست محصولات{% endblock %}

{% block content %}
<div class="container" dir="rtl">
  <h1>محصولات</h1>

  <form class="filters" method="get">
    <input type="text" name="q" placeholder="جستجو..." value="{{ request.GET.q }}">
    <input type="text" name="category" placeholder="شناسه دسته (Mongo)" value="{{ request.GET.category }}">
    <input type="text" name="brand" placeholder="برند" value="{{ request.GET.brand }}">
    <label style="display:flex;align-items:center;gap:.4rem;">
      <input type="checkbox" name="featured" value="1" {% if request.GET.featured %}checked{% endif %}> ویژه
    </label>
    <button type="submit">اعمال</button>
  </form>

  {% if products %}
    <ul class="cards">
      {% for p in products %}
        <li class="card">
          <a href="{% url 'product_detail' p.pk %}">
            <div class="img">
              {% if p.view_image %}<img src="{{ p.view_image.url }}" alt="{{ p.name }}">{% endif %}
              {% if p.featured %}<span class="badge">ویژه</span>{% endif %}
            </div>
            <div class="body">
              <div class="title">{{ p.name }}</div>
              {% if p.brand %}<div class="brand">برند: {{ p.brand.name }}</div>{% endif %}
              <div class="price">{{ p.price }}</div>
            </div>
          </a>
        </li>
      {% endfor %}
    </ul>

    {% if is_paginated %}
      <nav class="pagination">
        {% if page_obj.has_previous %}
          <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.brand %}&brand={{ request.GET.brand }}{% endif %}{% if request.GET.featured %}&featured=1{% endif %}">قبلی</a>
        {% endif %}
        <span>صفحه {{ page_obj.number }} از {{ paginator.num_pages }}</span>
        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.brand %}&brand={{ request.GET.brand }}{% endif %}{% if request.GET.featured %}&featured=1{% endif %}">بعدی</a>
        {% endif %}
      </nav>
    {% endif %}
  {% else %}
    <p>محصولی یافت نشد.</p>
  {% endif %}
</div>

<style>
.container{max-width:1100px;margin:2rem auto;padding:0 1rem}
.filters{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:1rem}
.cards{list-style:none;padding:0;display:grid;gap:1rem;grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
.card{border:1px solid #eee;border-radius:12px;background:#fff;overflow:hidden}
.card a{display:block;color:inherit;text-decoration:none}
.img{position:relative;height:180px;background:#fafafa;display:grid;place-items:center}
.img img{width:100%;height:100%;object-fit:cover}
.badge{position:absolute;top:.5rem;left:.5rem;background:#1C39BB;color:#fff;border-radius:999px;padding:.2rem .6rem;font-size:.8rem}
.body{padding:.7rem .9rem}
.title{font-weight:700;margin-bottom:.25rem}
.brand{font-size:.9rem;color:#666}
.price{margin-top:.25rem;font-weight:700}
.pagination{display:flex;gap:1rem;align-items:center;margin-top:1rem}
</style>
{% endblock %}

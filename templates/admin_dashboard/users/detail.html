{% extends "admin_dashboard/dashboard.html" %}

{% block title %}جزئیات کاربر: {{ user_obj.phone_number }}{% endblock %}

{% block mainContent %}
<div class="container-fluid px-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-white">جزئیات کاربر</h2>
    <a href="{% url 'admin_dashboard:admin_users_list' %}" class="btn btn-secondary">بازگشت</a>
  </div>

  <!-- User Info -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-dark text-white">
      <h5 class="mb-0">اطلاعات کاربر</h5>
    </div>
    <div class="card-body">
      <p><strong>نام:</strong> {{ user_obj.get_full_name|default:"-" }}</p>
      <p><strong>شماره تماس:</strong> {{ user_obj.phone_number }}</p>
      <p><strong>ایمیل:</strong> {{ user_obj.email|default:"-" }}</p>
      <p><strong>تاریخ عضویت:</strong> {{ user_obj.date_joined|date:"Y/m/d H:i" }}</p>
      <p><strong>آخرین ورود:</strong> {{ user_obj.last_login|date:"Y/m/d H:i"|default:"-" }}</p>
      <p><strong>نقش:</strong>
        {% if user_obj.is_staff %}<span class="badge bg-warning text-dark">ادمین</span>
        {% elif user_obj.is_superuser %}<span class="badge bg-danger">سوپریوزر</span>
        {% else %}<span class="badge bg-secondary">کاربر عادی</span>
        {% endif %}
      </p>
    </div>
  </div>

  <!-- Orders -->
  {% if user_orders %}
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">سفارشات</h5>
    </div>
    <div class="card-body p-0">
      <table class="table table-striped mb-0">
        <thead class="table-dark">
          <tr>
            <th>سفارش</th>
            <th>مبلغ</th>
            <th>وضعیت</th>
            <th>تاریخ</th>
          </tr>
        </thead>
        <tbody>
          {% for o in user_orders %}
          <tr>
            <td>#{{ o.id }}</td>
            <td>{{ o.total_price|floatformat:0 }} تومان</td>
            <td><span class="badge bg-{{ o.get_status_display|cut:' ' }}">{{ o.get_status_display }}</span></td>
            <td>{{ o.created_at|date:"Y/m/d" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}

  <!-- Blogs -->
  {% if user_blogs %}
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-success text-white">
      <h5 class="mb-0">وبلاگ‌های کاربر</h5>
    </div>
    <div class="card-body">
      <ul>
        {% for b in user_blogs %}
        <li>
          <a href="{% url 'admin_dashboard:admin_blog_edit' b.pk %}">{{ b.name }}</a>
          ({{ b.publish_time|date:"Y/m/d" }})
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
  {% endif %}

  <!-- News -->
  {% if user_news %}
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-info text-white">
      <h5 class="mb-0">اخبار کاربر</h5>
    </div>
    <div class="card-body">
      <ul>
        {% for n in user_news %}
        <li>
          <a href="{% url 'admin_dashboard:admin_news_edit' n.pk %}">{{ n.name }}</a>
          ({{ n.publish_time|date:"Y/m/d" }})
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
  {% endif %}

  <!-- Cart Items -->
  {% if user_cart_items %}
  <div class="card shadow-sm">
    <div class="card-header bg-warning text-dark">
      <h5 class="mb-0">سبد خرید</h5>
    </div>
    <div class="card-body p-0">
      <table class="table table-striped mb-0">
        <thead>
          <tr>
            <th>محصول</th>
            <th>تعداد</th>
          </tr>
        </thead>
        <tbody>
          {% for item in user_cart_items %}
          <tr>
            <td>{{ item.product.name }}</td>
            <td>{{ item.quantity }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
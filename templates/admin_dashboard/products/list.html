{% extends "admin_dashboard/dashboard.html" %}

{% block title %}مدیریت محصولات{% endblock %}

{% block mainContent %}
<div class="container-fluid px-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-white">محصولات</h2>
    <a href="{% url 'admin_dashboard:admin_product_create' %}" class="btn btn-success">
      <i class="fas fa-plus"></i> افزودن محصول جدید
    </a>
  </div>

  {# 🔎 Optional search #}
  <div class="mb-3">
    <input type="text" id="productSearch" class="form-control" placeholder="جستجو در محصولات..." />
  </div>

  {% if products %}
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <table class="table table-striped table-hover mb-0 align-middle">
        <thead class="table-dark">
          <tr>
            <th style="width:72px;">تصویر</th>
            <th>نام</th>
            <th>برند</th>
            <th>قیمت</th>
            <th>موجودی</th>
            <th>فعال</th>
            <th>عملیات</th>
          </tr>
        </thead>
        <tbody id="productTableBody">
          {% for product in products %}
          <tr>
            <td>
              {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" style="height:56px;width:56px;object-fit:cover;border-radius:.5rem;border:1px solid #e9ecef;">
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>

            <td>{{ product.name }}</td>

            <td>
              {% if product.brand %}{{ product.brand.name|default:product.brand }}{% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>

            <td>
              {% if product.price %}
                {{ product.price }}
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>

            <td>
              {% firstof product.stock product.inventory product.quantity as stock %}
              {% if stock is not None %}
                {{ stock }}
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>

            <td>
              {% if product.is_active %}
                <span class="badge bg-success">فعال</span>
              {% else %}
                <span class="badge bg-danger">غیرفعال</span>
              {% endif %}
            </td>

            <td>
              <div class="btn-group">
                <a href="{% url 'admin_dashboard:admin_product_edit' product.pk %}" class="btn btn-sm btn-warning">ویرایش</a>
                <button type="button"
                        class="btn btn-sm btn-danger"
                        data-bs-toggle="modal"
                        data-bs-target="#deleteModal"
                        data-id="{{ product.pk }}"
                        data-name="{{ product.name }}">
                  حذف
                </button>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% include 'admin_dashboard/_pagination.html' %}
  {% else %}
  <div class="alert alert-info">محصولی یافت نشد.</div>
  {% endif %}

  {# Global delete modal #}
  {% include 'admin_dashboard/_delete_modal.html' with object_type="محصول" delete_url_name='admin_dashboard:admin_product_delete' delete_dummy_pk=0 return_url='admin_dashboard:admin_products' %}
</div>

<script>
  // Simple client-side filter
  document.getElementById('productSearch').addEventListener('keyup', function () {
    const term = this.value.toLowerCase();
    document.querySelectorAll('#productTableBody tr').forEach(tr => {
      tr.style.display = tr.textContent.toLowerCase().includes(term) ? '' : 'none';
    });
  });
</script>
{% endblock %}

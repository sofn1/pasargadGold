{% extends "admin_dashboard/dashboard.html" %}

{% block title %}Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØµÙˆÙ„Ø§Øª{% endblock %}

{% block mainContent %}
<div class="container-fluid px-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-white">Ù…Ø­ØµÙˆÙ„Ø§Øª</h2>
    <a href="{% url 'admin_dashboard:admin_product_create' %}" class="btn btn-success">
      <i class="fas fa-plus"></i> Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯
    </a>
  </div>

  {# ğŸ” Optional search #}
  <div class="mb-3">
    <input type="text" id="productSearch" class="form-control" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù…Ø­ØµÙˆÙ„Ø§Øª..." />
  </div>

  {% if products %}
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <table class="table table-striped table-hover mb-0 align-middle">
        <thead class="table-dark">
          <tr>
            <th style="width:72px;">ØªØµÙˆÛŒØ±</th>
            <th>Ù†Ø§Ù…</th>
            <th>Ø¨Ø±Ù†Ø¯</th>
            <th>Ù‚ÛŒÙ…Øª</th>
            <th>Ù…ÙˆØ¬ÙˆØ¯ÛŒ</th>
            <th>ÙØ¹Ø§Ù„</th>
            <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
          </tr>
        </thead>
        <tbody id="productTableBody">
          {% for product in products %}
          <tr>
            <td>
              {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" style="height:56px;width:56px;object-fit:cover;border-radius:.5rem;border:1px solid #e9ecef;">
              {% else %}
                <span class="text-muted">â€”</span>
              {% endif %}
            </td>

            <td>{{ product.name }}</td>

            <td>
              {% if product.brand %}{{ product.brand.name|default:product.brand }}{% else %}
                <span class="text-muted">â€”</span>
              {% endif %}
            </td>

            <td>
              {% if product.price %}
                {{ product.price }}
              {% else %}
                <span class="text-muted">â€”</span>
              {% endif %}
            </td>

            <td>
              {% firstof product.stock product.inventory product.quantity as stock %}
              {% if stock is not None %}
                {{ stock }}
              {% else %}
                <span class="text-muted">â€”</span>
              {% endif %}
            </td>

            <td>
              {% if product.is_active %}
                <span class="badge bg-success">ÙØ¹Ø§Ù„</span>
              {% else %}
                <span class="badge bg-danger">ØºÛŒØ±ÙØ¹Ø§Ù„</span>
              {% endif %}
            </td>

            <td>
              <div class="btn-group">
                <a href="{% url 'admin_dashboard:admin_product_edit' product.pk %}" class="btn btn-sm btn-warning">ÙˆÛŒØ±Ø§ÛŒØ´</a>
                <button type="button"
                        class="btn btn-sm btn-danger"
                        data-bs-toggle="modal"
                        data-bs-target="#deleteModal"
                        data-id="{{ product.pk }}"
                        data-name="{{ product.name }}">
                  Ø­Ø°Ù
                </button>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% include 'admin_dashboard/_pagination.html' %}
  {% else %}
  <div class="alert alert-info">Ù…Ø­ØµÙˆÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</div>
  {% endif %}

  {# Global delete modal #}
  {% include 'admin_dashboard/_delete_modal.html' with object_type="Ù…Ø­ØµÙˆÙ„" delete_url_name='admin_dashboard:admin_product_delete' delete_dummy_pk=0 return_url='admin_dashboard:admin_products' %}
</div>

<script>
  // Simple client-side filter
  document.getElementById('productSearch').addEventListener('keyup', function () {
    const term = this.value.toLowerCase();
    document.querySelectorAll('#productTableBody tr').forEach(tr => {
      tr.style.display = tr.textContent.toLowerCase().includes(term) ? '' : 'none';
    });
  });
</script>
{% endblock %}

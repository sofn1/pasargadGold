{% extends "admin_dashboard/dashboard.html" %}

{% block title %}مدیریت سفارشات{% endblock %}

{% block mainContent %}
<div class="container-fluid px-4">
  <h2 class="my-4 text-white">سفارشات</h2>

  <!-- Filter -->
  <form method="get" class="mb-4">
    <select name="status" class="form-select w-auto d-inline-block me-2" onchange="this.form.submit()">
      <option value="">همه وضعیت‌ها</option>
      {% for value, display in view.get_queryset.model.STATUS_CHOICES %}
        <option value="{{ value }}" {% if request.GET.status == value %}selected{% endif %}>{{ display }}</option>
      {% endfor %}
    </select>
  </form>

  <!-- Table -->
  {% if orders %}
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <table class="table table-striped table-hover mb-0">
        <thead class="table-dark">
          <tr>
            <th>سفارش</th>
            <th>کاربر</th>
            <th>مبلغ</th>
            <th>وضعیت</th>
            <th>تاریخ</th>
            <th>جزئیات</th>
          </tr>
        </thead>
        <tbody>
          {% for order in orders %}
          <tr>
            <td>#{{ order.id }}</td>
            <td>{{ order.user.phone_number }}</td>
            <td>{{ order.total_price|floatformat:0 }} تومان</td>
            <td><span class="badge bg-{{ order.get_status_display|cut:' ' }}">{{ order.get_status_display }}</span></td>
            <td>{{ order.created_at|date:"Y/m/d" }}</td>
            <td><a href="{% url 'admin_dashboard:admin_order_detail' order.pk %}" class="btn btn-sm btn-info">مشاهده</a></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% include 'admin_dashboard/_pagination.html' %}
  {% else %}
  <div class="alert alert-info">سفارشی یافت نشد.</div>
  {% endif %}
</div>
{% endblock %}
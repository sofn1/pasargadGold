{% extends "admin_dashboard/dashboard.html" %}

{% block title %}داشبورد ادمین{% endblock %}

{% block mainContent %}
<div class="container-fluid px-4">
  <h2 class="my-4 text-white">خلاصه وضعیت سیستم</h2>

  <!-- Stats Cards -->
  <div class="row g-4 mb-4">
    <div class="col-6 col-md-4 col-xl-2">
      <div class="card bg-primary text-white h-100">
        <div class="card-body d-flex flex-column">
          <h6>کاربران</h6>
          <h3>{{ total_users }}</h3>
          <small>فعال: {{ active_users }}</small>
        </div>
      </div>
    </div>

    <div class="col-6 col-md-4 col-xl-2">
      <div class="card bg-success text-white h-100">
        <div class="card-body d-flex flex-column">
          <h6>محصولات</h6>
          <h3>{{ total_products }}</h3>
        </div>
      </div>
    </div>

    <div class="col-6 col-md-4 col-xl-2">
      <div class="card bg-info text-white h-100">
        <div class="card-body d-flex flex-column">
          <h6>وبلاگ‌ها</h6>
          <h3>{{ total_blogs }}</h3>
        </div>
      </div>
    </div>

    <div class="col-6 col-md-4 col-xl-2">
      <div class="card bg-warning text-dark h-100">
        <div class="card-body d-flex flex-column">
          <h6>اخبار</h6>
          <h3>{{ total_news }}</h3>
        </div>
      </div>
    </div>

    <div class="col-6 col-md-4 col-xl-2">
      <div class="card bg-danger text-white h-100">
        <div class="card-body d-flex flex-column">
          <h6>سفارشات</h6>
          <h3>{{ total_orders }}</h3>
          <small>در انتظار: {{ pending_orders }}</small>
        </div>
      </div>
    </div>

    <div class="col-6 col-md-4 col-xl-2">
      <div class="card bg-secondary text-white h-100">
        <div class="card-body d-flex flex-column">
          <h6>درآمد</h6>
          <h3>{{ total_revenue|floatformat:0 }} تومان</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Sales Chart -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-dark text-white">
      <h5 class="mb-0">فروش ۷ روز اخیر</h5>
    </div>
    <div class="card-body">
      <canvas id="salesChart" height="100"></canvas>
    </div>
  </div>

  <!-- Recent Orders -->
  <div class="card shadow-sm">
    <div class="card-header bg-dark text-white">
      <h5 class="mb-0">آخرین سفارشات</h5>
    </div>
    <div class="card-body p-0">
      {% if recent_orders %}
      <table class="table table-hover mb-0">
        <thead class="table-dark">
          <tr>
            <th>سفارش</th>
            <th>کاربر</th>
            <th>مبلغ</th>
            <th>وضعیت</th>
            <th>تاریخ</th>
          </tr>
        </thead>
        <tbody>
          {% for order in recent_orders %}
          <tr>
            <td>#{{ order.id }}</td>
            <td>{{ order.user.full_name|default:order.user.phone_number }}</td>
            <td>{{ order.total_price|floatformat:0 }} تومان</td>
            <td>
              <span class="badge bg-{{ order.get_status_display|cut:' ' }} text-capitalize">
                {{ order.get_status_display }}
              </span>
            </td>
            <td>{{ order.created_at|date:"Y/m/d H:i" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <div class="text-center p-5 text-muted">هیچ سفارشی یافت نشد.</div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}


{% block extra_css %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('salesChart').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: {{ chart_labels|safe }},
      datasets: [{
        label: 'فروش (تومان)',
        data: {{ chart_data|safe }},
        borderColor: '#0d6efd',
        tension: 0.3
      }]
    },
    options: { responsive: true, maintainAspectRatio: false }
  });
</script>
{% endblock %}

{% comment %} Beautiful & responsive update form (Seller) — consistent with Writer style {% endcomment %}
{% if form.errors %}
  <div class="alert alert-danger mb-4">
    <i class="fas fa-exclamation-circle me-1"></i>
    لطفاً خطاهای زیر را بررسی کنید.
  </div>
{% endif %}

<div class="row g-4">

  <!-- Basic info -->
  <div class="col-12">
    <div class="section-title">
      <i class="fas fa-id-card"></i> مشخصات فردی
    </div>
    <hr class="mt-1 mb-3">
  </div>

  <div class="col-12 col-md-6">
    <label class="form-label" for="{{ form.first_name.id_for_label }}">نام</label>
    <div class="input-group">
      <span class="input-group-text"><i class="fas fa-user"></i></span>
      {{ form.first_name }}
    </div>
    {% if form.first_name.errors %}{% for e in form.first_name.errors %}<div class="text-danger small mt-1">{{ e }}</div>{% endfor %}{% endif %}
  </div>

  <div class="col-12 col-md-6">
    <label class="form-label" for="{{ form.last_name.id_for_label }}">نام خانوادگی</label>
    <div class="input-group">
      <span class="input-group-text"><i class="fas fa-user-tag"></i></span>
      {{ form.last_name }}
    </div>
    {% if form.last_name.errors %}{% for e in form.last_name.errors %}<div class="text-danger small mt-1">{{ e }}</div>{% endfor %}{% endif %}
  </div>

  <div class="col-6 col-md-3">
    <label class="form-label" for="{{ form.age.id_for_label }}">سن</label>
    <div class="input-group">
      <span class="input-group-text"><i class="fas fa-birthday-cake"></i></span>
      {{ form.age }}
    </div>
    {% if form.age.errors %}{% for e in form.age.errors %}<div class="text-danger small mt-1">{{ e }}</div>{% endfor %}{% endif %}
  </div>

  <div class="col-12 col-md-9">
    <label class="form-label" for="{{ form.email.id_for_label }}">ایمیل</label>
    <div class="input-group">
      <span class="input-group-text"><i class="fas fa-envelope"></i></span>
      {{ form.email }}
    </div>
    {% if form.email.errors %}{% for e in form.email.errors %}<div class="text-danger small mt-1">{{ e }}</div>{% endfor %}{% endif %}
  </div>

  <!-- Business -->
  <div class="col-12 mt-2">
    <div class="section-title">
      <i class="fas fa-briefcase"></i> اطلاعات کسب‌وکار
    </div>
    <hr class="mt-1 mb-3">
  </div>

  <div class="col-12 col-md-6">
    <label class="form-label" for="{{ form.business_name.id_for_label }}">نام کسب‌وکار</label>
    <div class="input-group">
      <span class="input-group-text"><i class="fas fa-store-alt"></i></span>
      {{ form.business_name }}
    </div>
    {% if form.business_name.errors %}{% for e in form.business_name.errors %}<div class="text-danger small mt-1">{{ e }}</div>{% endfor %}{% endif %}
  </div>

  <div class="col-12 col-md-6">
    <label class="form-label" for="{{ form.business_code.id_for_label }}">کد کسب‌وکار</label>
    <div class="input-group">
      <span class="input-group-text"><i class="fas fa-hashtag"></i></span>
      {{ form.business_code }}
    </div>
    {% if form.business_code.errors %}{% for e in form.business_code.errors %}<div class="text-danger small mt-1">{{ e }}</div>{% endfor %}{% endif %}
  </div>

  <!-- Address -->
  <div class="col-12 mt-2">
    <div class="section-title">
      <i class="fas fa-map-marked-alt"></i> آدرس و موقعیت
    </div>
    <hr class="mt-1 mb-3">
  </div>

  <div class="col-12">
    <label class="form-label" for="{{ form.address.id_for_label }}">آدرس</label>
    <div class="input-group">
      <span class="input-group-text"><i class="fas fa-map-pin"></i></span>
      {{ form.address }}
    </div>
    {% if form.address.errors %}{% for e in form.address.errors %}<div class="text-danger small mt-1">{{ e }}</div>{% endfor %}{% endif %}
  </div>

  <div class="col-12 col-md-6">
    <label class="form-label" for "{{ form.location.id_for_label }}">موقعیت</label>
    <div class="input-group">
      <span class="input-group-text"><i class="fas fa-location-arrow"></i></span>
      {{ form.location }}
    </div>
    {% if form.location.errors %}{% for e in form.location.errors %}<div class="text-danger small mt-1">{{ e }}</div>{% endfor %}{% endif %}
  </div>

  <!-- Profile / About -->
  <div class="col-12 mt-2">
    <div class="section-title">
      <i class="fas fa-user-circle"></i> پروفایل فروشنده
    </div>
    <hr class="mt-1 mb-3">
  </div>

  <div class="col-12">
    <label class="form-label" for="{{ form.about_us.id_for_label }}">درباره ما</label>
    <div class="input-group">
      <span class="input-group-text"><i class="fas fa-align-left"></i></span>
      {{ form.about_us }}
    </div>
    <div class="field-note mt-1">چند خط دربارهٔ کسب‌وکار…</div>
    {% if form.about_us.errors %}{% for e in form.about_us.errors %}<div class="text-danger small mt-1">{{ e }}</div>{% endfor %}{% endif %}
  </div>

  <div class="col-12 col-md-6">
    <label class="form-label d-block" for="{{ form.profile_image.id_for_label }}">تصویر پروفایل</label>
    <div class="d-flex align-items-center gap-3 flex-wrap">

      <!-- current image -->
      <div class="d-flex align-items-center gap-2">
        {% if seller and seller.profile_image %}
          <img src="{{ seller.profile_image.url }}" alt="current avatar" class="avatar-lg" id="seller-current-avatar">
        {% else %}
          <div class="avatar-lg d-flex align-items-center justify-content-center bg-dark-subtle text-white">
            <i class="fas fa-user"></i>
          </div>
        {% endif %}
        <small class="field-note d-block">تصویر فعلی</small>
      </div>

      <!-- new preview -->
      <div class="d-flex align-items-center gap-2">
        <img src="" alt="" class="avatar-lg d-none" id="seller-new-avatar-preview">
        <small class="field-note d-block">پیش‌نمایش تصویر جدید</small>
      </div>
    </div>

    <div class="input-group mt-2">
      <span class="input-group-text"><i class="fas fa-image"></i></span>
      {{ form.profile_image }}
    </div>
    <div class="field-note mt-1">فرمت‌های مجاز: JPG, PNG, WEBP. اندازه پیشنهادی: 512×512.</div>
    {% if form.profile_image.errors %}{% for e in form.profile_image.errors %}<div class="text-danger small mt-1">{{ e }}</div>{% endfor %}{% endif %}
  </div>

</div>

{% block extra_js %}
<script>
  (function () {
    const root = document.currentScript.closest('.row');
    if (!root) return;

    // Add Bootstrap classes to inputs
    root.querySelectorAll('input[type="text"], input[type="email"], input[type="number"], textarea').forEach(function(el){
      el.classList.add('form-control');
      if (!el.placeholder) {
        const lbl = root.querySelector('label[for="'+ el.id +'"]');
        if (lbl) el.placeholder = lbl.textContent.trim();
      }
    });

    // File inputs
    root.querySelectorAll('input[type="file"]').forEach(function(el){
      el.classList.add('form-control');
      el.setAttribute('accept', 'image/*');
    });

    // Live preview for profile image
    const input = document.getElementById("{{ form.profile_image.id_for_label }}");
    const preview = document.getElementById("seller-new-avatar-preview");
    if (input && preview) {
      input.addEventListener("change", function (e) {
        const file = e.target.files && e.target.files[0];
        if (!file) { preview.classList.add("d-none"); preview.src = ""; return; }
        const reader = new FileReader();
        reader.onload = function (ev) {
          preview.src = ev.target.result;
          preview.classList.remove("d-none");
        };
        reader.readAsDataURL(file);
      });
    }
  })();
</script>
{% endblock %}

{% block extra_css %}
<style>
  .section-title {
    font-size: .95rem;
    font-weight: 700;
    opacity: .85;
    margin-bottom: .75rem;
    display: inline-flex;
    align-items: center;
    gap: .5rem;
  }
  .avatar-lg {
    width: 80px; height: 80px; object-fit: cover; border-radius: 12px;
    border: 1px dashed rgba(255,255,255,.25);
  }
  .field-note { opacity:.75; font-size:.85rem; }
</style>
{% endblock %}

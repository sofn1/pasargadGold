{% extends "admin_dashboard/dashboard.html" %}

{% block title %}مدیریت برندها{% endblock %}

{% block mainContent %}
<div class="container-fluid px-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-white">برندها</h2>
    <a href="{% url 'admin_dashboard:admin_brand_create' %}" class="btn btn-success">
      <i class="fas fa-plus"></i> افزودن برند جدید
    </a>
  </div>

  <!-- Table -->
  {% if brands %}

    <div class="card shadow-sm">
      <div class="card-body p-0">
        <table class="table table-striped table-hover mb-0 align-middle">
          <thead class="table-dark">
            <tr>
              <th style="width:64px;">تصویر</th>
              <th>نام</th>
              <th>توضیحات</th>
              <th style="width:180px;">عملیات</th>
            </tr>
          </thead>
          <tbody>
            {% for brand in brands %}
            <tr>
              <td>
                {% if brand.image %}
                  {# build a robust URL even if only a relative name is stored #}
                  {% with img_url=brand.image.url|default:brand.image.name|default:'' %}
                    {% if img_url %}
                      <img
                        src="{% if img_url|slice:':1' == '/' %}{{ img_url }}{% else %}{{ MEDIA_URL }}{{ img_url }}{% endif %}"
                        alt="{{ brand.name }}"
                        class="img-thumbnail"
                        loading="lazy"
                        style="width:48px;height:48px;object-fit:cover;border-radius:.5rem;"
                      >
                    {% else %}
                      <span class="badge bg-secondary">بدون تصویر</span>
                    {% endif %}
                  {% endwith %}
                {% else %}
                  <span class="badge bg-secondary">بدون تصویر</span>
                {% endif %}
              </td>

              <td>{{ brand.name }}</td>
              <td>{{ brand.description|default:"—"|truncatechars:100 }}</td>

              <td>
                <div class="btn-group">
                  <a href="{% url 'admin_dashboard:admin_brand_edit' brand.pk %}" class="btn btn-sm btn-warning">ویرایش</a>
                  <button type="button" class="btn btn-sm btn-danger"
                          data-bs-toggle="modal"
                          data-bs-target="#deleteModal"
                          data-id="{{ brand.pk }}"
                          data-name="{{ brand.name }}">
                    حذف
                  </button>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>



  {% include 'admin_dashboard/_pagination.html' %}
  {% else %}
  <div class="alert alert-info">برندی یافت نشد.</div>
  {% endif %}

  <!-- Delete Modal -->
  {% include 'admin_dashboard/_delete_modal.html' with object_type="برند" delete_url_name='admin_dashboard:admin_brand_delete' %}
</div>
{% endblock %}
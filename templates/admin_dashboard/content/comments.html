{% extends "admin_dashboard/dashboard.html" %}

{% block title %}مدیریت نظرات{% endblock %}

{% block mainContent %}
<div class="container-fluid px-4">
  <h2 class="my-4 text-white">نظرات کاربران</h2>

  <!-- Filter -->
  <div class="mb-4">
    <a href="?status=all" class="btn btn-sm {% if request.GET.status == 'all' or not request.GET.status %}btn-primary{% else %}btn-outline-primary{% endif %}">همه</a>
    <a href="?status=flagged" class="btn btn-sm {% if request.GET.status == 'flagged' %}btn-warning{% else %}btn-outline-warning{% endif %}">گزارش‌شده</a>
    <a href="?status=hidden" class="btn btn-sm {% if request.GET.status == 'hidden' %}btn-danger{% else %}btn-outline-danger{% endif %}">مخفی</a>
  </div>

  <!-- Table -->
  {% if comments %}
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <table class="table table-striped table-hover mb-0">
        <thead class="table-dark">
          <tr>
            <th>کاربر</th>
            <th>متن</th>
            <th>مربوط به</th>
            <th>تاریخ</th>
            <th>وضعیت</th>
            <th>عملیات</th>
          </tr>
        </thead>
        <tbody>
          {% for comment in comments %}
          <tr>
            <td>{{ comment.user.phone_number }}</td>
            <td>{{ comment.content|truncatechars:60 }}</td>
            <td>{{ comment.content_type.model|title }}</td>
            <td>{{ comment.created_at|date:"Y/m/d H:i" }}</td>
            <td>
              {% if comment.status == 'visible' %}
                <span class="badge bg-success">نمایش داده شده</span>
              {% elif comment.status == 'hidden' %}
                <span class="badge bg-danger">مخفی</span>
              {% else %}
                <span class="badge bg-warning text-dark">گزارش شده</span>
              {% endif %}
            </td>
            <td>
              <form method="post" class="d-inline">
                {% csrf_token %}
                <input type="hidden" name="comment_id" value="{{ comment.id }}">
                {% if comment.status == 'visible' %}
                  <button name="action" value="hide" class="btn btn-sm btn-warning">مخفی کن</button>
                {% elif comment.status == 'hidden' %}
                  <button name="action" value="show" class="btn btn-sm btn-success">نشان بده</button>
                {% else %}
                  <button name="action" value="hide" class="btn btn-sm btn-warning">مخفی کن</button>
                {% endif %}
                <button name="action" value="delete" class="btn btn-sm btn-danger">حذف</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% include 'admin_dashboard/_pagination.html' %}
  {% else %}
  <div class="alert alert-info">نظری یافت نشد.</div>
  {% endif %}
</div>
{% endblock %}
{% extends "admin_dashboard/dashboard.html" %}

{% block title %}نظرات اخبار{% endblock %}

{% block mainContent %}
<div class="container-fluid px-4">
  <h2 class="my-4 text-white">نظرات روی اخبار</h2>

  <!-- Filter Tabs -->
  <ul class="nav nav-tabs mb-4">
    <li class="nav-item">
      <a class="nav-link {% if not request.GET.status or request.GET.status == 'all' %}active{% endif %}"
         href="?status=all">همه</a>
    </li>
    <li class="nav-item">
      <a class="nav-link {% if request.GET.status == 'flagged' %}active{% endif %}"
         href="?status=flagged">گزارش‌شده</a>
    </li>
    <li class="nav-item">
      <a class="nav-link {% if request.GET.status == 'hidden' %}active{% endif %}"
         href="?status=hidden">مخفی</a>
    </li>
  </ul>

  {% if comments %}
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <table class="table table-striped table-hover mb-0">
        <thead class="table-dark">
          <tr>
            <th>کاربر</th>
            <th>متن نظر</th>
            <th>خبر</th>
            <th>تاریخ</th>
            <th>وضعیت</th>
            <th>عملیات</th>
          </tr>
        </thead>
        <tbody>
          {% for comment in comments %}
          <tr>
            <td>{{ comment.user.phone_number }}</td>
            <td>{{ comment.content|truncatechars:60 }}</td>
            <td>
              {% if comment.content_object %}
                <a href="{% url 'admin_dashboard:admin_news_edit' comment.content_object.pk %}">
                  {{ comment.content_object.name|truncatechars:40 }}
                </a>
              {% else %}
                <span class="text-muted">حذف شده</span>
              {% endif %}
            </td>
            <td>{{ comment.created_at|date:"Y/m/d H:i" }}</td>
            <td>
              {% if comment.status == 'visible' %}
                <span class="badge bg-success">نمایش داده شده</span>
              {% elif comment.status == 'hidden' %}
                <span class="badge bg-danger">مخفی</span>
              {% else %}
                <span class="badge bg-warning text-dark">گزارش شده</span>
              {% endif %}
            </td>
            <td>
              <form method="post" class="d-inline">
                {% csrf_token %}
                <input type="hidden" name="comment_id" value="{{ comment.id }}">
                {% if comment.status == 'visible' %}
                  <button name="action" value="hide" class="btn btn-sm btn-warning">مخفی کن</button>
                {% elif comment.status == 'hidden' %}
                  <button name="action" value="show" class="btn btn-sm btn-success">نشان بده</button>
                {% else %}
                  <button name="action" value="hide" class="btn btn-sm btn-warning">مخفی کن</button>
                {% endif %}
                <button name="action" value="delete" class="btn btn-sm btn-danger">حذف</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% include 'admin_dashboard/_pagination.html' %}
  {% else %}
  <div class="alert alert-info">نظری روی اخبار یافت نشد.</div>
  {% endif %}
</div>
{% endblock %}
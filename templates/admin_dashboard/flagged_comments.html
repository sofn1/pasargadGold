<!-- templates/admin_dashboard/flagged_comments.html -->
{% extends "admin_dashboard/_base.html" %}

{% block title %}نظرات گزارش‌شده{% endblock %}

{% block mainContent %}
<div class="container-fluid px-4">
  <h2 class="my-4 text-white">نظرات گزارش‌شده توسط کاربران</h2>

  <div class="card shadow-sm border-0">
    <div class="card-body p-0">
      {% if flagged_comments %}
        <table class="table table-hover mb-0">
          <thead class="table-dark">
            <tr>
              <th>مقاله</th>
              <th>نظر</th>
              <th>کاربر</th>
              <th>تعداد گزارش</th>
              <th>تاریخ</th>
              <th>عملیات</th>
            </tr>
          </thead>
          <tbody>
            {% for flag in flagged_comments %}
            <tr>
              <td class="text-nowrap">
                <small class="text-muted">{{ flag.comment.article.title|truncatechars:40 }}</small>
              </td>
              <td>
                <small>{{ flag.comment.content|truncatechars:60 }}</small>
              </td>
              <td>{{ flag.comment.user.get_full_name|default:flag.comment.user.email }}</td>
              <td>
                <span class="badge bg-danger">{{ flag.report_count }}</span>
              </td>
              <td>{{ flag.created_at|date:"Y/m/d H:i" }}</td>
              <td>
                <a href="{% url 'admin:admin_flagged_comments_detail' flag.id %}"
                   class="btn btn-sm btn-outline-primary btn-nowrap">
                  <i class="fas fa-eye"></i> مشاهده
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="text-center p-5 text-muted">
          <i class="fas fa-flag fa-2x mb-3 opacity-50"></i>
          <p>نظر گزارش‌شده‌ای وجود ندارد.</p>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Pagination -->
  {% if flagged_comments.has_other_pages %}
    <nav class="mt-4">
      <ul class="pagination justify-content-center">
        {% if flagged_comments.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page={{ flagged_comments.previous_page_number }}">قبلی</a>
          </li>
        {% else %}
          <li class="page-item disabled">
            <span class="page-link">قبلی</span>
          </li>
        {% endif %}

        {% for i in flagged_comments.paginator.page_range %}
          <li class="page-item {% if flagged_comments.number == i %}active{% endif %}">
            <a class="page-link" href="?page={{ i }}">{{ i }}</a>
          </li>
        {% endfor %}

        {% if flagged_comments.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ flagged_comments.next_page_number }}">بعدی</a>
          </li>
        {% else %}
          <li class="page-item disabled">
            <span class="page-link">بعدی</span>
          </li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}
</div>
{% endblock %}
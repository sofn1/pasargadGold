<!-- templates/admin_dashboard/low_stock.html -->
{% extends "admin_dashboard/_base.html" %}

{% block title %}محصولات با موجودی کم{% endblock %}

{% block mainContent %}
<div class="container-fluid px-4">
  <h2 class="my-4 text-white">محصولات با موجودی کم</h2>

  <div class="alert alert-warning mb-4" style="direction: rtl;">
    <strong>⚠️ هشدار:</strong> این محصولات به حداقل موجودی خود نزدیک شده‌اند.
    برای جلوگیری از کمبود انبار، سفارش تکمیلی دهید.
  </div>

  <div class="card shadow-sm border-0">
    <div class="card-body p-0">
      {% if low_stock_products %}
        <div class="table-responsive">
          <table class="table table-striped mb-0 align-middle">
            <thead class="table-dark">
              <tr>
                <th>نام محصول</th>
                <th>دسته</th>
                <th>موجودی</th>
                <th>حداقل موجودی</th>
                <th>قیمت</th>
                <th>عملیات</th>
              </tr>
            </thead>
            <tbody>
              {% for product in low_stock_products %}
              <tr>
                <td class="text-nowrap">
                  <strong>{{ product.name|truncatechars:40 }}</strong>
                </td>
                <td>{{ product.category.name|default:"نامشخص" }}</td>
                <td>
                  <span class="badge bg-danger bg-gradient">
                    {{ product.stock }}
                  </span>
                </td>
                <td>
                  <span class="badge bg-warning text-dark">{{ product.min_stock_level }}</span>
                </td>
                <td class="text-nowrap">
                  {{ product.price|intcomma }} <small class="text-muted">تومان</small>
                </td>
                <td>
                  <a href="{% url 'admin:admin_product_edit' product.id %}"
                     class="btn btn-sm btn-outline-primary btn-nowrap">
                    <i class="fas fa-edit"></i> ویرایش
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        {% if low_stock_products.has_other_pages %}
          <nav class="p-3 bg-light bg-opacity-10 border-top">
            <ul class="pagination justify-content-center mb-0">
              {% if low_stock_products.has_previous %}
                <li class="page-item">
                  <a class="page-link" href="?page={{ low_stock_products.previous_page_number }}">قبلی</a>
                </li>
              {% else %}
                <li class="page-item disabled"><span class="page-link">قبلی</span></li>
              {% endif %}

              {% for i in low_stock_products.paginator.page_range %}
                <li class="page-item {% if low_stock_products.number == i %}active{% endif %}">
                  <a class="page-link" href="?page={{ i }}">{{ i }}</a>
                </li>
              {% endfor %}

              {% if low_stock_products.has_next %}
                <li class="page-item">
                  <a class="page-link" href="?page={{ low_stock_products.next_page_number }}">بعدی</a>
                </li>
              {% else %}
                <li class="page-item disabled"><span class="page-link">بعدی</span></li>
              {% endif %}
            </ul>
          </nav>
        {% endif %}

      {% else %}
        <div class="text-center p-5 text-muted">
          <i class="fas fa-box-open fa-2x opacity-50 mb-3"></i>
          <p class="mb-0">محصولی با موجودی کم یافت نشد.</p>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}